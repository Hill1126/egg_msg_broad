<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的留言记录</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/css/user.css">

    <script src="/js/jquery.min.js"></script>
</head>
<body >

<!-- 头部信息 -->
<div id="header"></div>


<div class="layui-container">
    <!-- 留言tabs-->
    <div class="layui-tab layui-tab-card"  lay-filter="tab" style="width: 1170px;">
    <ul class="layui-tab-title">
        <li class="layui-this">我的留言</li>
    </ul>

    <div class="layui-tab-content" style="height: 1000px;">
        <div class="layui-tab-item layui-show">
            <!-- 留言展示部分-->
            {% for item in list %}
            <div class="layui-container" id="{{item._id}}" >

                <div class="layui-row">
                    <!-- 留言名字留言内容 -->
                    <div class="layui-row" >
                        <div class="layui-card">
                            <div class="layui-card-header">
                                <img src="{{item.creator.avatar}}" class="layui-nav-img">  【{{item.creator.name}}】  <label>{{item.createTime}}</label>
                            </div>
                            <div class="layui-card-body" id="context_{{item._id}}">{{item.context}}</div>
                        </div>
                    </div>
                    <div class="layui-row" >
                        <div class="layui-col-md2">
                            <button type="button" class="layui-btn layui-btn-sm" id="lockComment2">查看评论</button>共<span>{{item.replies.length}}</span>条
                        </div>
                        <div class="layui-col-md3  layui-col-md-offset7">
                            <button type="button" onclick="deleteComment('{{item._id}}')" class="layui-btn layui-btn-sm layui-btn-danger">删除</button>
                            <button type="button" onclick="editComment('{{item._id}}')" class="layui-btn layui-btn-sm">编辑</button>
                        </div>

                    </div>

                    {% if item.replies.length > 0%}
                    <div class="comment">
                        <div class="reply_list" id="reply_list1" >
                            <div class="reply" >
                                <span class="reply_name">小白</span>回复<span class="reply_name">小黑</span>：<span class="reply_content">你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好 </span>
                                <a  data-id="1" class="del_reply">
                                    <i class="icon layui-icon " >    删除</i>
                                </a>
                            </div>
                            <div class="reply">
                                <span class="reply_name">小白</span>回复<span class="reply_name">小黑</span>：<span class="reply_content">你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊 </span>
                                <a  data-id="1" class="del_reply">
                                    <i class="icon layui-icon" >    删除</i>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                </div>

                <!-- 留言展示框 -->

                <hr>

            </div>
            {% endfor %}
            <!-- 分页按钮-->
            <div  class="layui-row">
                <div id="demo1"></div>
            </div>
        </div>
    </div>
</div>


</div>

<script src="/layui/layui.js"></script>
<script type="text/javascript" src="/js/utils.js"></script>
<script>
  layui.use(['element','form','layer','laypage'], function(){
    const laypage = layui.laypage;
    //总页数大于页码总数
    laypage.render({
      elem: 'demo1'
      ,count: {{count}} //数据总数
      ,jump: function(obj){
        console.log(obj)
      }
    });

  });

  function editComment(commentId) {
    const contextId = "#context_"+commentId;
    // 修改弹出框里面的内容
    const context = $(contextId).html();
    layer.open({
      type: 1,
      title: '请输入修改内容',
      area: ['900px', '600px'],
      shadeClose: true, //点击遮罩关闭
      // skin: 'yourclass',
      content: `<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md12">
            <form class="layui-form" >
                <textarea  id="text_board" lay-verify="required"  lay-reqtext="请输入留言内容" placeholder="请输入留言" class="layui-textarea">${context}</textarea>
                <button class="layui-btn"  onclick="updateComment('${commentId}')" id="submit" lay-submit lay-filter="formDemo">修改留言</button>
            </form>
        </div>
    </div>
</div>`,
    });


  }

  <!-- 提交留言 -->
  function updateComment(commentId) {
    const context = $("#text_board").val();
    $.ajax({
      url:`/api/comment/${commentId}`,
      data:{context:context},
      type: 'put',
      success: function(data) {
       layer.msg('更新成功');
      }
    });
  }

  function deleteComment(commentId) {
    layer.confirm('确定要删除留言吗？', {
      btn: ['取消','确定'] //按钮
    }, function(){
      layer.closeAll();
    }, function(){
      $.ajax({
        url:`/api/comment/${commentId}`,
        type: 'Delete',
        success: function(data) {
          $(`#${commentId}`).remove();
        }
      });
    });

  }

</script>
</body>
</html>
