<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>header</title>


  <link rel="stylesheet" href="/layui/css/layui.css">

  <link type="text/css" href="/css/index.css" rel="stylesheet" />

  <script src="../js/jquery.min.js"></script>
  <script src="../layui/layui.js"></script>


</head>
<body  bgcolor="#F2F2F2" >

  <!-- 头部信息 -->
  <div id="header"></div>
  <!-- 青色分割线-->
  <hr class="layui-bg-cyan">
  <!-- 留言表单 -->
  <div class="layui-container">
    <div class="layui-row">
      <div class="layui-col-md12">
        <form class="layui-form" >
          <textarea  id="text_board" lay-verify="required"  lay-reqtext="请输入留言内容" placeholder="请输入留言" class="layui-textarea"></textarea>
          <button class="layui-btn" id="submit" lay-submit lay-filter="formDemo">提交留言</button>
        </form>
      </div>
    </div>
  </div>
  <!-- 留言展示部分-->
  <div class="layui-container" >
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
      <legend>看看大家说了什么</legend>
    </fieldset>

    {% for item in list %}
    <div class="layui-row">
      <!-- 留言名字留言内容 -->
      <div class="layui-row">
        <div class="layui-card">
          <div class="layui-card-header">
            <img src="{{item.creator.avatar}}" class="layui-nav-img"> 【{{item.creator.name}}】 <label>{{ helper.parseDateString(item.createTime) }}</label>
          </div>
          <div class="layui-card-body">
            {{item.context}}
          </div>
        </div>
      </div>
      <!-- 按钮-->
      <div class="layui-row" >
        <div class="layui-col-md2">
          <button type="button" class="layui-btn layui-btn-sm" id="lookButton{{loop.index}}">查看评论</button>共<span>{{item.replies.length}}</span>条
        </div>
        <div class="layui-col-md3  layui-col-md-offset7">
          <button type="button" class="layui-btn layui-btn-sm layui-btn-danger">删除</button>
          <button type="button" class="layui-btn layui-btn-sm">编辑</button>
          <button type="button" class="layui-btn layui-btn-sm">评论</button>
        </div>

      </div>
      {% if item.replies.length>0 %}
      <!-- 回复-->
      <div class="layui-row" >
          <div class="reply_list" id="reply_list" >

              <div class="reply" >
                <span class="reply_name">小白</span>回复<span class="reply_name">小黑</span>：<span class="reply_content">你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好没啊你好 </span>

                <a  data-id="1" class="del_reply">
                  <i class="icon layui-icon" style=" cursor:pointer;" >删除</i>
                </a>

                <a  data-id="1" class="del_reply">
                  <i class="icon layui-icon" style=" cursor:pointer;" >编辑</i>  &nbsp;&nbsp;
                </a>

                <a  data-id="1" class="del_reply">
                  <i class="icon layui-icon" style=" cursor:pointer;">回复</i>&nbsp;&nbsp;
                </a>
              </div>
          </div>
      </div>
      {% endif %}
    </div>
    <hr>
    {% endfor %}

  <!-- 分页按钮-->
  <div  class="layui-row">
    <div id="demo1"></div>
  </div>
  </div>

</body>
<script type="text/javascript" src="/js/utils.js"></script>
<script>
  //注意：导航 依赖 element 模块，否则无法进行功能性操作
  layui.use(['element','form','layer','laypage'], function(){
    const form = layui.form;
    const laypage = layui.laypage;
    //总页数大于页码总数
    laypage.render({
      elem: 'demo1'
      ,count: {{count}} //数据总数
      ,jump: function(obj){
        console.log(obj)
      }
    });
  });

  <!-- 提交留言 -->
  $('#submit').click(()=> {
    const context = $("#text_board").val();
    $.post('/api/comment', {context}, (data, status) => {
        const res = data;
        alert(JSON.parse(res));
        if (res.code === 1) {
          layui.layer.msg(res.msg);
        } else {
          layui.layer.msg(res.msg);
        }
      }
    );
  });


  $("#lockComment2").click(function(){
    $(".reply_list").toggle();
  });


</script>
</html>
